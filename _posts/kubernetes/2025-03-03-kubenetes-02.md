---
title: Kubernetes ì •ë¦¬ - 02
description: >-
  Kubernetes ê´€ë ¨í•œ ê°œë…ê³¼ ì‚¬ìš©ì— ëŒ€í•œ ì •ë¦¬ ì…ë‹ˆë‹¤.
author: dgkim
date: 2025-03-02 08:26:00 +0900
categories: [í•™ìŠµ]
tags: [Kubernetes]
pin: false
media_subpath: '/assets/posts/20250303'
comments: true
---
# Kubernetes

ì§€ë‚œ ë²ˆì— ì´ì–´ì„œ ì´ë²ˆì—ëŠ” ì™¸ë¶€ì— ë…¸ì¶œí•˜ëŠ” ê²ƒì„ ì‹œë„í•´ë³´ë ¤ í•œë‹¤. 
> ì—¬ê¸°ì„œëŠ” ëª…ë ¹í˜•ìœ¼ë¡œ ë°°í¬ë¥¼ ì‹œë„í•œë‹¤. ì„ ì–¸í˜• ë°©ì‹ì€ í›„ì— í•´ë³´ë ¤ í•œë‹¤.

## Service
Podì™€ Pod ì‚¬ì´ í˜¹ì€ í´ëŸ¬ìŠ¤í„° ì™¸ë¶€ì— ë…¸ì¶œí•˜ê¸° ìœ„í•´ì„œëŠ” Service ê°ì²´ê°€ í•„ìš”í•˜ë‹¤.
PodëŠ” ë””í´íŠ¸ë¡œ ì´ë¯¸ ë‚´ë¶€ ip ì´ë¯¸ ë‚´ë¶€ ip ì£¼ì†Œë¥¼ ê°€ì§€ê³  ìˆì§€ë§Œ ì™¸ë¶€ì—ì„œ podì— ì ‘ê·¼í•˜ëŠ”ë° ì‚¬ìš©í•  ìˆ˜ ì—†ê³ , podê°€ êµì²´ë  ë•Œë§ˆë‹¤ ë³€ê²½ëœë‹¤. ë”°ë¼ì„œ íŠ¹ì • podë¥¼ ì‹ë³„í•˜ëŠ” ê²ƒì€ ì–´ë ¤ìš¸ ìˆ˜ ìˆë‹¤.

ServiceëŠ” Podë¥¼ ê·¸ë£¹í™”í•˜ê³  ë³€ê²½ë˜ì§€ ì•Šê³  ì™¸ë¶€ì— ë…¸ì¶œë  ìˆ˜ ìˆëŠ” ê³µìœ  ì£¼ì†Œ, ê³µìœ  IPë¥¼ ì œê³µí•  ìˆ˜ ìˆë‹¤.

## ì´ë¯¸ì§€ ì¤€ë¹„

Serviceë¥¼ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•œ Docker Imageë¥¼ ì¤€ë¹„í•œë‹¤. docker hubì— bravecat81/demo-apië¥¼ ì˜¬ë ¸ë‹¤.

``` Dockerfile
FROM node:lts-alpine

WORKDIR /usr/src/app

COPY ./package.json .

RUN npm install

COPY . .

EXPOSE 3000

RUN chown -R node /usr/src/app

USER node
CMD ["node", "./dist/app.js"]
```
docker ì´ë¯¸ì§€ ë¹Œë“œ

``` bash
$ docker bulid -t bravecat81/demo-api .
```
docker ì´ë¯¸ì§€ ê²Œì‹œ 
* docker hubì— ê°œì¸ ë¦¬í¬ë¥¼ ë§Œë“¤ê³  ì§„í–‰í•´ì•¼ í•œë‹¤.

``` bash
$ docker push bravecat81/demo-api
```

## Minikube ì¤€ë¹„
ì•„ë˜ ì²˜ëŸ¼ í˜„ì¬ minikube ìƒíƒœë¥¼ í™•ì¸ í•œë‹¤. ë§Œì•½ ë™ì‘ì¤‘ì´ì§€ ì•Šë‹¤ë©´ start ì‹œì¼œì¤€ë‹¤.

``` bash
$ minikube status
minikube
type: Control Plane
host: Running
kubelet: Running
apiserver: Running
kubeconfig: Configured
```

``` bash
$ minikube start --driver=docker
ğŸ˜„  minikube v1.35.0 on Ubuntu 24.04
âœ¨  Using the docker driver based on existing profile
ğŸ‘  Starting "minikube" primary control-plane node in "minikube" cluster
ğŸšœ  Pulling base image v0.0.46 ...
ğŸƒ  Updating the running docker "minikube" container ...
ğŸ³  Preparing Kubernetes v1.32.0 on Docker 27.4.1 ...    â–ª Using image gcr.io/k8s-minikube/storage-provisioner:v5

ğŸ”  Verifying Kubernetes components...
ğŸŒŸ  Enabled addons: default-storageclass, storage-provisioner
ğŸ„  Done! kubectl is now configured to use "minikube" cluster and "default" namespace by default
```

## Deployment ìƒì„±

``` bash
$ kubectl create deployment demo-api-deployment --image=bravecat81/demo-api --port=3000
deployment.apps/demo-api-deployment created
```

``` bash
$ kubectl get pod
NAME                                   READY   STATUS    RESTARTS   AGE
demo-api-deployment-7d8b54c465-h7xbk   1/1     Running   0          22s
```

## Service ìƒì„±

``` bash
kubectl expose deployment demo-api-deployment --port=80 --target-port=3000 --type=LoadBalancer
```

* ***type***: ClusterIP, NodePort, LoadBalancer, ê·¸ë¦¬ê³  ExternalNameê°€ ìˆë‹¤.
  - ClusterIp: í´ë˜ìŠ¤í„° ë‚´ë¶€ì—ì„œ ì‚¬ìš©ë˜ëŠ” IPì´ë‹¤. ClusterIPëŠ” í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œ í†µì‹ í• ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
  - NodePort: Nodeì— ì§ì ‘ ì—°ê²°í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
    * Nodeë„ Pod ê¸°ì¤€ìœ¼ë¡œ ë´¤ì„ ë•ŒëŠ” ë³€ë™ ê°€ëŠ¥í•œ ìì›ì´ë‹¤. ê·¸ê²ƒì€ NodePortë¥¼ ì“¸ë•ŒëŠ” ì˜ì•Œê³  ì¨ì•¼ í•œë‹¤ëŠ” ê²ƒì´ë‹¤.
    * Nodeê°€ ë‹¤ìš´ë˜ë©´ ì“¸ìˆ˜ ì—†ë‹¤. PodëŠ” ì—¬ëŸ¬ ì›Œì»¤ ë…¸ë“œì— ë¶„í¬í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ê°ì•ˆí•´ì•¼ í•œë‹¤.
  - LoadBalancer: Pod ê·¸ë£¹ì— ëŒ€í•´ì„œ ì™¸ë¶€ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” IPë¥¼ ì œê³µí•œë‹¤.
  - ExternalName: ì´ê²ƒì€ ìš©ë„ê°€ ë‹¤ë¥´ë‹¤.(ì™¸ë¶€ ë„ë©”ì¸ì„ ë§µí•‘í•œë‹¤.)


``` bash
$ kubectl get service
NAME                  TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE
demo-api-deployment   LoadBalancer   10.100.240.225   <pending>     80:30609/TCP   8s
kubernetes            ClusterIP      10.96.0.1        <none>        443/TCP        27h
```

Serviceê°€ ìƒì„±ëœ ê²ƒì„ í™•ì¸ í–ˆë‹¤. í•˜ì§€ë§Œ Minikubeë¥¼ ì“°ê³  ìˆì–´ì„œ ë°”ë¡œ ì—°ê²°ì€ ì•ˆëœë‹¤. ì´ê²ƒì„ ë¡œì»¬ ë„¤íŠ¸ì›Œí¬ì™€ 
ì—°ê²°í•˜ëŠ” ì‘ì—…ì„ í•´ì¤˜ì•¼ í•œë‹¤.

``` bash
$ minikube service demo-api-deployment
|-----------|---------------------|-------------|---------------------------|
| NAMESPACE |        NAME         | TARGET PORT |            URL            |
|-----------|---------------------|-------------|---------------------------|
| default   | demo-api-deployment |          80 | http://192.168.49.2:30609 |
|-----------|---------------------|-------------|---------------------------|
ğŸ‰  Opening service default/demo-api-deployment in default browser...

```

ë¸Œë¼ìš°ì ¸ê°€ ë°”ë¡œ ì—´ë¦¬ì§€ë§Œ ë¸Œë¼ìš°ì ¸ë¥¼ ë‹«ì€ ì´í›„ì—ë„ 
ìœ„ì— URLë¡œ í‘œì‹œëœ `http://192.168.49.2:30609`ìœ¼ë¡œ ì ‘ê·¼í•˜ë©´ ì„œë¹„ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

## ì¶”ê°€ì ì¸ ë‚´ìš©

ëŒ€ì‹œë³´ë“œ ì—´ê¸°!

``` bash
minikube dashboard 
```

![Minikube dashboard](minikube-dashboard.png)

LoadBalancerì„ ì“°ëŠ” ì´ìœ ì— ëŒ€í•´ì„œ Podê°€ ëŠ˜ì–´ë‚˜ë„ ê³µê°œëœ ì£¼ì†ŒIPë¡œ ì ‘ê·¼í•œë‹¤ë©´ ë¬¸ì œì—†ì´ í†µì‹ í•  ìˆ˜ ìˆë‹¤.
ë‹¤ë§Œ ì‹¤ë¬´ì—ì„œëŠ” LoadBalancerì´ë€ ìì›ì˜ ê°€ê²© ë¬¸ì œ ë•Œë¬¸ì— ì¢€ ê¸°í”¼í•˜ëŠ” ê²ƒ ê°™ê¸°ëŠ” í•˜ë‹¤...
ì´ê²ƒ ì—­ì‹œ íšŒí”¼í•˜ëŠ” ë°©ë²•ì´ ìˆìœ¼ë‚˜ í˜„ì¬ë¡œì„œëŠ” LoadBalancerë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì´ ê°€ì¥ ê°„í¸í•˜ë‹¤.

``` bash
$ kubectl scale deployment/demo-api-deployment --replicas 10
deployment.apps/demo-api-deployment scaled
```
![Minikube dashboard - replicas 10 ì ìš©](replicas.png)

## ì£¼ìš” ëª…ë ¹ì–´
- minikube start: ë¯¸ë‹ˆì¿ ë² ì˜ í´ëŸ¬ìŠ¤í„°ë¥¼ ì‹œì‘í•œë‹¤. 
- minikube status: ë¯¸ë‹ˆì¿ ë² ì˜ í´ëŸ¬ìŠ¤í„°ê°€ êµ¬ë™ì¤‘ì¸ì§€ í™•ì¸í•œë‹¤.
- minikybe dashboard: ëŒ€ì‹œë³´ë“œ ì›¹ ì‚¬ì´íŠ¸ í™œì„±í™”
- kubectl create: ë­”ê°€ ê°ì²´ë¥¼ ë§Œë“ ë‹¤. ì¼ë°˜ì ìœ¼ë¡œ deplymentë¥¼ ê°€ì¥ ë§ì´ ë§Œë“ ë‹¤.
- kubectl expose: ëŒ€ìƒ ê°ì²´ì— ëŒ€í•´ ì„œë¹„ìŠ¤ë¥¼ ìƒì„±í•œë‹¤.
- kubectl get: ê°ì²´ì˜ ìƒíƒœë¥¼ ê°€ì ¸ì˜¨ë‹¤.
- kubectl delete: ê°ì²´ë¥¼ ì‚­ì œí•œë‹¤.

## ì£¼ìš” ê°ì²´
- deployment
- service
